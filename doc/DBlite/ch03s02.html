<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>2.&nbsp;Error handling</title><link rel="stylesheet" href="html.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.65.1"><link rel="home" href="index.html" title="DBlite developer documentation"><link rel="up" href="ch03.html" title="Chapter&nbsp;3.&nbsp;Using regular queries and fetching data"><link rel="previous" href="ch03s01.html" title="1.&nbsp;Using $assoc argument for getAll and getRow"><link rel="next" href="ch04.html" title="Chapter&nbsp;4.&nbsp;Introduction to Dynamic SQL"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">2.&nbsp;Error handling</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03s01.html">Prev</a>&nbsp;</td><th width="60%" align="center">Chapter&nbsp;3.&nbsp;Using regular queries and fetching data</th><td width="20%" align="right">&nbsp;<a accesskey="n" href="ch04.html">Next</a></td></tr></table><hr></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="d0e281"></a>2.&nbsp;Error handling</h2></div></div><div></div></div><p>Every library nowdays implements error handling itself. We wanted to create minimalistic error handling code, but rather provide as much information as possible.</p><p>If error occurs during query, DBlite will not return any error strings, but instead it will just return "false". Additionally it will call error-handler before that. It might be unusual to how it's done elsewhere:</p><pre class="screen">...
$result = query();
if(is_error($result)){
  handle_error();
  return false;
}
...</pre><p>Using DBlite it is simpler:</p><pre class="screen">...
if(query()===false)return false;
...</pre><p>Our point is that user should not check for errors everywhere. Even if user does not check return codes application will work as normal and report error if happened:</p><pre class="screen">...
query();
...</pre><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e298"></a>2.1.&nbsp;Setting up error handler</h3></div></div><div></div></div><p>We knew DBlite would be used in object oriented environment, where static functions migth not exist at all. Therefore error handler can call method of the object you give to him. Assign errorr_handler_class and error_handler_method. If you assign just error_handler_method, it will be called as a static function.</p><pre class="screen">class API {
 var $db;
 function error_handler($caller,$str,$info=null){
  ...
 }
 function foo(){
   $this-&gt;db-&gt;error_handler_class =&amp; $this;
   $this-&gt;db-&gt;error_handler_method = 'error_handler';
   if($this-&gt;db-&gt;query("select a from b")===false)return false;
   if($this-&gt;db-&gt;query("update b set a=1")===false)return false;
 }</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="d0e305"></a>2.2.&nbsp;Writing error handler</h3></div></div><div></div></div><p>Consider example from the previous section. <tt class="function">error_handler</tt> will receive 3 arguments:</p><div class="glosslist"><dl><dt>$caller</dt><dd><p>Reference to DBlite class. It might be useful since you can pull more information from it, such as username or hostname.</p></dd><dt>$str</dt><dd><p>Error message string. It will be something like "Can't execute query"</p></dd><dt>$info</dt><dd><p>This array contains additional pieces of information which was collected during error. The contents may vary depending on database driver and <tt class="function">error()</tt> implementation. Usually you will receive "error" which is returned by database, "query_str" is a original query (note that even if getRow fails, you will receive "quey_str") and "caller" is a place in your code where you executed query. All this information will be useful for debuging, however it should not be displayed to user for safety reasons.</p></dd></dl></div></div></div><div class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03s01.html">Prev</a>&nbsp;</td><td width="20%" align="center"><a accesskey="u" href="ch03.html">Up</a></td><td width="40%" align="right">&nbsp;<a accesskey="n" href="ch04.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">1.&nbsp;Using $assoc argument for getAll and getRow&nbsp;</td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top">&nbsp;Chapter&nbsp;4.&nbsp;Introduction to Dynamic SQL</td></tr></table></div></body></html>