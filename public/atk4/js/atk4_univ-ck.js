/* Welcome to Agile Toolkit JS framework. This file provides universal chain. */// jQuery allows you to manipulate element by doing chaining. Similarly univ provides
// loads of simple functions to perform action chaining.
//
jQuery||console.error("jQuery must be loaded");(function($){$.each({alert:function(e){alert(e)},setTimeout:function(e,t){setTimeout(e,t)},setInterval:function(e,t){return setInterval(e,t)},clearInterval:function(e){clearInterval(e)},displayAlert:function(e){alert(e)},redirect:function(e,t){$.fn.atk4_load&&$("#Content").hasClass("atk4_loader")?$.univ.page(e,t):$.univ.location(e)},redirectURL:function(e,t){$.univ.redirect(e,t)},location:function(e){e=$.atk4.addArgument(e);e?document.location=e:document.location.reload(!0)},page:function(e,t){$c=$("#Content");$c.length||($c=this.jquery);$c.atk4_load(e,t)},log:function(e){console&&console.log(e)},consoleError:function(e){console&&(console.error?console.error(e):console.log("Error: "+e))},confirm:function(e){e||(e="Are you sure?");confirm(e)||(this.ignore=!0)},displayFormError:function(e,t,n){console.log(e,t,n);if(!n){n=t;t=e}if(e)var r=$(e);this.alert(t+": "+n)},setFormFocus:function(e,t){$("#"+e+" input[name="+e+"_"+t).focus()},closeExpander:function(){var e=this.jquery.closest(".lister_expander").parent().prev().find(".expander");e.length||(e=$(".expander"));e.atk4_expander("collapse")},closeExpanderWidget:function(){this.closeExpander()},reloadExpandedRow:function(e){e||(e=this.jquery.closest(".lister_expander").parent().prev().attr("rel"));this.closeExpander();var t=this.jquery.closest(".atk4_grid");t.atk4_grid("reloadRow",e)},removeExpandedRow:function(e){e||(e=this.jquery.closest(".lister_expander").parent().prev().attr("rel"));this.closeExpander();var t=this.jquery.closest(".atk4_grid");t.atk4_grid("removeRow",e)},loadRegionUrlEx:function(e,t){$("#"+e).load(t)},memorizeExpander:function(){},submitForm:function(form,button,spinner){var successHandler=function(response_text){if(response_text)try{eval(response_text)}catch(e){w=window.open(null,null,"height=400,width=700,location=no,menubar=no,scrollbars=yes,status=no,titlebar=no,toolbar=no");if(w){w.document.write("<h2>Error in AJAX response: "+e+"</h2>");w.document.write(response_text);w.document.write('<center><input type=button onclick="window.close()" value="Close"></center>')}else{console.log(response_text,e);showMessage("Error in AJAX response: "+e+"\n"+response_text)}try{eval(response_text.substring(response_text.indexOf("//ajax_script_start"),response_text.lastIndexOf("//ajax_script_end")))}catch(e){if(w){w.document.write("<h2>Error in AJAX response: "+e+"</h2>");w.document.write(response_text);w.document.write('<center><input type=button onclick="window.close()" value="Close"></center>')}else showMessage("Could not parse response. "+e)}}else showMessage("Warning: Empty response from server");spinner&&spinner_off(spinner)};if(button){btn_value=button.substring(button.lastIndexOf("_")+1);button=$('<input name="'+button+'" id="'+button+'" value="'+btn_value+'" type="hidden">');$("#"+form).append(button)}$(form).append($('<input name="ajax_submit" id="ajax_submit" value="1" type="hidden">'));$(form).ajaxSubmit({success:successHandler});button&&button.remove()},addArgument:function(e,t){return $.atk4.addArgument(e,t)},reloadArgs:function(e,t,n){var r=$.atk4.addArgument(e,t+"="+n);this.jquery.atk4_load(r)},reload:function(e,t,n){this.jquery.atk4_reload(e,t,n)},reloadParent:function(e,t){e||(e=1);var n=this.jquery,r=n;while(e-->0){n=n.closest(".atk4_loader");n.length&&(r=n);e?n=n.parent():n.length?n.atk4_loader("reload",t):r.atk4_loader("reload",t)}},reloadContents:function(e,t,n){t&&$.each(t,function(t,n){e=$.atk4.addArgument(e,t+"="+n)});this.jquery.atk4_load(e,n)},saveSelected:function(name,url){result=new Array;i=0;$("#"+name+" input[type=checkbox]").each(function(){result[i]=$(this).attr("value")+":"+($(this).attr("checked")==1?"Y":"N");i++});$.get(url+"&selected="+result.join(","),null,function(res){try{eval(res)}catch(e){w=window.open(null,null,"height=400,width=700,location=no,menubar=no,scrollbars=yes,status=no,titlebar=no,toolbar=no");if(w){w.document.write("<h2>Error in AJAX response: "+e+"</h2>");w.document.write(res);w.document.write('<center><input type=button onclick="window.close()" value="Close"></center>')}else showMessage("Error in AJAX response: "+e+"\n"+response_text)}})},executeUrl:function(e,t){$.get(e,t)},ajaxFunc:function(e){$.globalEval(e)},reloadRow:function(e){var t=this.jquery.closest(".atk4_grid");t.atk4_grid("reloadRow",e)},removeRow:function(e){var t=this.jquery.closest(".atk4_grid");t.atk4_grid("removeRow",e)},removeOverlay:function(){var e=this.jquery.closest(".atk4_grid");e.length||console.log("removeOverlay cannot find grid");e.atk4_grid("removeOverlay")},dialogPrepare:function(e){var t=$('<div class="dialog dialog_autosize" title="Untitled"><div style="min-height: 300px"></div>').appendTo("body");e.noAutoSizeHack&&t.removeClass("dialog_autosize");t.dialog(e);e.customClass&&t.parent().addClass(e.customClass);$.data(t.get(0),"opener",this.jquery);$.data(t.get(0),"options",e);return t},getDialogData:function(e){var t=this.jquery.closest(".dialog").get(0);if(!t)return null;var n=$.data(t,e);return n?n:null},getFrameOpener:function(){var e=this.getDialogData("opener");return e?$(this.getDialogData("opener")):null},dialogBox:function(e){return this.dialogPrepare($.extend({bgiframe:!0,modal:!0,width:1e3,position:{my:"top",at:"top+100",of:window},autoOpen:!1,beforeclose:function(){if($(this).is(".atk4_loader")&&!$(this).atk4_loader("remove"))return!1},buttons:{Ok:function(){var e=$(this).find("form");e.length?e.eq(0).submit():$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},open:function(e){$("body").css({overflow:"hidden"});$(e.target).css({"max-height":$(window).height()-180})},close:function(){$("body").css({overflow:"auto"});$(this).dialog("destroy");$(this).remove()}},e))},dialogURL:function(e,t,n,r){if(typeof t=="undefined"){t=e;e="Untitled Dialog"}var i=this.dialogBox($.extend(n,{title:e,autoOpen:!0}));i.closest(".ui-dialog").hide().fadeIn("slow");i.atk4_load(t,r);return i.dialog("open")},frameURL:function(e,t,n,r){n=$.extend({buttons:{}},n);return this.dialogURL(e,t,n,r)},dialogOK:function(e,t,n,r){var i=this.dialogBox($.extend({title:e,width:450,close:n,open:function(){$(this).parents(".ui-dialog-buttonpane button:eq(0)").focus()},buttons:{Ok:function(){$(this).dialog("close")}}},r));i.html(t);i.dialog("open")},dialogConfirm:function(e,t,n,r){var i=this.dialogBox($.extend({title:e,width:450,height:200},r));i.html("<form></form>"+t);i.find("form").submit(function(e){e.preventDefault();n&&n();i.dialog("close")});i.dialog("open")},dialogError:function(e,t,n){this.dialogConfirm("Error",'<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>'+e,null,$.extend({buttons:{Ok:function(){$(this).dialog("close");n&&n()}}},t))},dialogAttention:function(e,t,n){this.dialogConfirm("Attention!",'<span class="ui-icon ui-icon-alert" style="float:left; margin:0 7px 20px 0;"></span>'+e,null,$.extend({buttons:{Ok:function(){$(this).dialog("close");n&&n()}}},t))},message:function(e,t){if($.ui.atk4_notify&&$("#atk-growl-holder").length){$("#atk-growl-holder").atk4_notify().atk4_notify("message",e,t);return}},successMessage:function(e){var t="";if($.ui.atk4_notify&&$("#atk-growl-holder").length){$("#atk-growl-holder").atk4_notify().atk4_notify("successMessage",e);return}return alert(e)},errorMessage:function(e){var t="";if($.ui.atk4_notify&&$("#atk-growl-holder").length){$("#atk-growl-holder").atk4_notify().atk4_notify("errorMessage",e);return}return alert(e)},fillFormFromFrame:function(e){var t=this.jquery,n=this.getFrameOpener();n=n.closest("form");var r=n.attr("id");$.each(e,function(e,t){n.atk4_form("setFieldValue",e,t)});this.jquery=t},closeDialog:function(){var e=this.getFrameOpener();if(!e)return;this.jquery.closest(".dialog").dialog("close");this.jquery=e},getjQuery:function(){return this.jquery},ajaxec:function(url,data,fn){region=this.jquery;if(region.data("ajaxec_loading"))return this.successMessage("Please Wait");region.data("ajaxec_loading",!0);if(data==1){data={};$.each(region.data(),function(e,t){typeof t!="object"&&(data[e]=t)})}$.atk4.get(url,data,function(ret){region.data("ajaxec_loading",!1);if(!$.atk4._checkSession(ret))return;try{eval(ret);fn&&fn()}catch(e){w=window.open(null,null,"height=400,width=700,location=no,menubar=no,scrollbars=yes,status=no,titlebar=no,toolbar=no");if(w){w.document.write("<h5>Error in AJAXec response: "+e+"</h5>");w.document.write(ret);w.document.write('<center><input type=button onclick="window.close()" value="Close"></center>')}else{console.log("Error in ajaxec response",e,ret);showMessage("Error in AJAXec response: "+e+"\n"+ret)}}},null,!0)},newWindow:function(e,t,n){window.open(e,t,n)},expr:function(str){return eval("("+str+")")},loadingInProgress:function(){this.successMessage("Loading is in progress. Please wait")},ajaxifyLinks:function(){this.jquery.find("td a").click(function(e){e.preventDefault();$(this).closest(".atk4_loader").atk4_loader("loadURL",$(this).attr("href"))})},autoChange:function(e){function r(){if(t.attr("data-val")==t.val())return;t.attr("data-val",t.val());var r=$.data(n,"timer");r&&clearTimeout(r);if(e){r=setTimeout(function(){$.data(n,"timer",null);t.trigger("autochange");t.change()},e);$.data(n,"timer",r)}else{t.trigger("autochange");t.change()}}var t=this.jquery,n=t.get(0);typeof e=="undefined"&&(e=1e3);t.attr("data-val",t.val());t.keyup(r);t.bind("autochange_manual",r)},numericField:function(){this.jquery.bind("keyup change",function(){var e=this.value.replace(/[^0-9\.-]/g,"");e!=this.value&&(this.value=e)})},onKey:function(e,t,n,r){this.jquery.bind("keydown",function(i){if(i.which==e&&(!n||i[n]==r)){i.preventDefault();i.stopPropagation();return t()}})},disableEnter:function(){this.jquery.bind("keydown keypress",function(e){if(e.which==13)return!1})},bindConditionalShow:function(e,t){var n=this.jquery,r=n.closest("form").parent();r.attr("id")||(r=r.parent());r=r.attr("id");typeof t=="undefined"&&(t="div.atk-row");var i=function(e){var n=[];fid=r;$.each(e,function(){var e=this[0]=="#"?this+"":"[data-shortname='"+this+"']",t=$(e,"#"+fid)[0];t?n.push(t):console.log("Field is not defined",e)});n=$(n);t&&(n=n.closest(t));return n},o=function(){if(n.is(".atk-checkboxlist,.atk-form-options")){var t=[];n.find("input:checked").each(function(){t.push(this.value)})}else var t=n.val();n.is(":checkbox")&&(t=n[0].checked?t:"");n.is("select")&&(t=n.find("option:selected").val());$.each(e,function(e,t){s=i(this);s.length&&s.hide()});var r=null;if(t instanceof Array){r=[];$.each(t,function(t,n){typeof e[n]!="undefined"&&r.push(i(e[n]))});!r.length&&typeof e["*"]!="undefined"&&(r=i(e["*"]))}else typeof e[t]!="undefined"?r=i(e[t]):typeof e["*"]!="undefined"&&(r=i(e["*"]));console.log(r);r&&r.length&&(r instanceof Array?$.each(r,function(e,t){t.show()}):r.show())};n.hasClass("field_reference")?n.bind("change_ref",o):n.hasClass("atk-checkboxlist")?n.find("input[type=checkbox]").bind("change",o):n.change(o);o()},bindFillInFields:function(fields){function onchange_fn(){function auto_fill(){$.each(fields,function(e,t){data&&data[e]&&$(t).val(data[e]).change().removeClass("manually_changed")})}var data=eval("("+f.attr("rel")+")"),myid=$(this).val();data=data[myid];var need_to_warn=!1;$.each(fields,function(e,t){data&&data[e]&&$(t).hasClass("manually_changed")&&$(t).val()&&(need_to_warn=!0)});need_to_warn?$(this).univ().dialogConfirm("Warning","Some fields you have edited are about to be auto filled. Would you like to proceed?",auto_fill):auto_fill()}var f=this.jquery;$.each(fields,function(e,t){$(t).change(function(){$(this).addClass("manually_changed")})});f.bind("change_ref change",onchange_fn)},nullFunction:function(){}},$.univ._import);$.extend($.univ,{toJSON:function(e,t){var n={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},r,i,s,o,u=/["\\\x00-\x1f\x7f-\x9f]/g,a;switch(typeof e){case"string":return u.test(e)?'"'+e.replace(u,function(e){var t=n[e];if(t)return t;t=e.charCodeAt();return"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)})+'"':'"'+e+'"';case"number":return isFinite(e)?String(e):"null";case"boolean":case"null":return String(e);case"object":if(!e)return"null";if(typeof e.toJSON=="function")return this.toJSON(e.toJSON());r=[];if(typeof e.length=="number"&&!e.propertyIsEnumerable("length")){o=e.length;for(i=0;i<o;i+=1)r.push(this.toJSON(e[i],t)||"null");return"["+r.join(",")+"]"}if(t){o=t.length;for(i=0;i<o;i+=1){s=t[i];if(typeof s=="string"){a=this.toJSON(e[s],t);a&&r.push(this.toJSON(s)+":"+a)}}}else for(s in e)if(typeof s=="string"){a=this.toJSON(e[s],t);a&&r.push(this.toJSON(s)+":"+a)}return"{"+r.join(",")+"}"}}});var oldcr=$.ui.dialog.prototype._create;$.ui.dialog.prototype._create=function(){var e=this;$("<div/>").insertBefore(this.element).on("remove",function(){e.element.remove()});oldcr.apply(this,arguments)};$.each(["openExpander"],function(e,t){$.univ[t]=function(){console.error("Function is deprecated:",t);return $.univ}});$.fn.extend({univ:function(){var e=new $.univ;e.jquery=this;return e}})})(jQuery);